# This pipeline is used to load the lineitem table from the raw schema into the bronze schema
# Pipeline variable puts the generate files in the same folder for the pipeline to pick up
pipeline: acme_edw_silver
# Flowgroup are conceptual artifacts and has no functional purpose
# there are used to group actions together in the generated files
flowgroup: supplier_silver_dim
presets:
  - default_delta_properties
actions:
  # Load is not neceseary here as everything is in the same pipeline
  # but it kept in case we decide to split the pipelines
  - name: write_supplier_silver_snapshot
    type: write
    source: v_supplier_bronze_snapshot
    write_target:
      type: streaming_table
      database: "{catalog}.{silver_schema}"
      table: "supplier_dim"
      mode: "snapshot_cdc"
      snapshot_cdc_config:
        source_function:
          file: "py_functions/supplier_snapshot_func.py"
          function: "next_snapshot_and_version"
        keys: ["supplier_id"]
        stored_as_scd_type: 2
        track_history_except_column_list: ["_source_file_path", "_processing_timestamp","snapshot_id","supplier_key","last_modified_dt"]
        